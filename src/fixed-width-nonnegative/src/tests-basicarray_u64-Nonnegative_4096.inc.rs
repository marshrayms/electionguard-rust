// Copyright (C) Microsoft Corporation. All rights reserved.

// NOTE: This file is intended to be include!()ed, in a specific context and not built directly.

pub fn hex_to_Nn4096(hex: &[&str]) -> Option<Nonnegative_4096> {
    let string = {
        let mut len = 0_usize;
        for &s in hex.iter() {
            len += s.len();
        }
        let mut string = String::with_capacity(len);
        for s in hex {
            string += s;
        }
        string
    };

    ::util::base16::hex_to_biguint(string.as_str())
    .and_then(|nn| crate::numbigint::Nonnegative_4096::try_from(nn).ok())
    .map(Nonnegative_4096::from)
}

use crate::basicarray_u64::Montgomery_4096;

pub fn hex_to_Montgomery4096(hex: &[&str]) -> Option<Montgomery_4096> {
    hex_to_Nn4096(hex).map(|nn| {
        crate::basicarray_u64::Montgomery_4096::
        from_nonnegative_value_that_caller_assures_us_is_in_montgomery_form(nn)
    })
}

#[test]
fn montgomery_precomputation_p() {
    let p = hex_to_Nn4096(&[
        "FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF",
        "B17217F7D1CF79ABC9E3B39803F2F6AF40F343267298B62D8A0D175B8BAAFA2B",
        "E7B876206DEBAC98559552FB4AFA1B10ED2EAE35C138214427573B291169B825",
        "3E96CA16224AE8C51ACBDA11317C387EB9EA9BC3B136603B256FA0EC7657F74B",
        "72CE87B19D6548CAF5DFA6BD38303248655FA1872F20E3A2DA2D97C50F3FD5C6",
        "07F4CA11FB5BFB90610D30F88FE551A2EE569D6DFC1EFA157D2E23DE1400B396",
        "17460775DB8990E5C943E732B479CD33CCCC4E659393514C4C1A1E0BD1D6095D",
        "25669B333564A3376A9C7F8A5E148E82074DB6015CFE7AA30C480A5417350D2C",
        "955D5179B1E17B9DAE313CDB6C606CB1078F735D1B2DB31B5F50B5185064C18B",
        "4D162DB3B365853D7598A1951AE273EE5570B6C68F96983496D4E6D330AF889B",
        "44A02554731CDC8EA17293D1228A4EF98D6F5177FBCF0755268A5C1F9538B982",
        "61AFFD446B1CA3CF5E9222B88C66D3C5422183EDC99421090BBB16FAF3D949F2",
        "36E02B20CEE886B905C128D53D0BD2F9621363196AF503020060E49908391A0C",
        "57339BA2BEBA7D052AC5B61CC4E9207CEF2F0CE2D7373958D762265890445744",
        "FB5F2DA4B751005892D356890DEFE9CAD9B9D4B713E06162A2D8FDD0DF2FD608",
        "FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF"
    ]).unwrap();

    let mgpc = MontgomeryPrecomputation_4096::new_opt(&p).unwrap();

    //eprintln!("\nMontgomeryPrecomputation_4096");

    //eprintln!("m: {:0wid$X}", mgpc.m(), wid=TEST_HEXDG);
    assert_eq!(*mgpc.m(), p);

    //eprintln!("r_nat: {:0wid$X}", mgpc.r_nat(), wid=TEST_HEXDG);
    assert_eq!(*mgpc.r_nat(), TwoRaisedToANonnegativePower::new(4096_u16));

    //eprintln!("r: {:0wid$X}", mgpc.r(), wid=TEST_HEXDG);
    assert_eq!(*mgpc.r(), hex_to_Nn4096(&[
        "0000000000000000000000000000000000000000000000000000000000000000",
        "4E8DE8082E308654361C4C67FC0D0950BF0CBCD98D6749D275F2E8A4745505D4",
        "184789DF92145367AA6AAD04B505E4EF12D151CA3EC7DEBBD8A8C4D6EE9647DA",
        "C16935E9DDB5173AE53425EECE83C7814615643C4EC99FC4DA905F1389A808B4",
        "8D31784E629AB7350A205942C7CFCDB79AA05E78D0DF1C5D25D2683AF0C02A39",
        "F80B35EE04A4046F9EF2CF07701AAE5D11A9629203E105EA82D1DC21EBFF4C69",
        "E8B9F88A24766F1A36BC18CD4B8632CC3333B19A6C6CAEB3B3E5E1F42E29F6A2",
        "DA9964CCCA9B5CC895638075A1EB717DF8B249FEA301855CF3B7F5ABE8CAF2D3",
        "6AA2AE864E1E846251CEC324939F934EF8708CA2E4D24CE4A0AF4AE7AF9B3E74",
        "B2E9D24C4C9A7AC28A675E6AE51D8C11AA8F4939706967CB692B192CCF507764",
        "BB5FDAAB8CE323715E8D6C2EDD75B1067290AE880430F8AAD975A3E06AC7467D",
        "9E5002BB94E35C30A16DDD4773992C3ABDDE7C12366BDEF6F444E9050C26B60D",
        "C91FD4DF31177946FA3ED72AC2F42D069DEC9CE6950AFCFDFF9F1B66F7C6E5F3",
        "A8CC645D414582FAD53A49E33B16DF8310D0F31D28C8C6A7289DD9A76FBBA8BB",
        "04A0D25B48AEFFA76D2CA976F210163526462B48EC1F9E9D5D27022F20D029F7",
        "0000000000000000000000000000000000000000000000000000000000000001"
    ]).unwrap());

    //eprintln!("r_inv: {:0wid$X}", mgpc.r_inv(), wid=TEST_HEXDG);
    assert_eq!(*mgpc.r_inv(), hex_to_Nn4096(&[
        "BF9B405D1C28111D456ACF32DC12355CFED23236158F7D0E08954A8DF3978161",
        "E60C086BC1B7D5CEB94BA33E8675144B23A08FEE288C52859F283EA3E0CDEF27",
        "CE2135E2D48247EE4C4897B8ADACE025A019A63020896CD0FFFC92402604FD0F",
        "E1146BB349EF9E766B3DEFFACB048C233D243D38389A100F02919B124321D9C5",
        "87DA5666111886886CACB21CFAA4526E9F0906E206150704040E433FC37B7658",
        "7591D7534B5DCDAF892C63D8B295B043EA4C8B3D45CB41B0881A5DB3E37D76C3",
        "42942411C34CE98D8357D24304D0978E4EFD12121189E8334DE1AF2FA77E9D96",
        "1E0FC19A9BDA50823B21301C842CE8D5FBA9E9149DCF6A821B66F2D67443DAB0",
        "30FE5A4665FA142F3AE8F9D0631147A864223CACDE9DD2C8F279C87953F8158A",
        "C35CA846B85C0F9E6BC43CD3844FA27F1D6C91FEC8446C9F3CB57FC3B2877E8C",
        "4BA7468278C2E6C30D80131D0547EB2B48C5D64341131B3A19CA9326EEB3B291",
        "866E7F060C8DF689CEBAD599DD80E0D094C772ABBD792E61D2352985C38C12B6",
        "A6E10DD80DDF25DBF7126F1436115424B5875AB84E78658F510EAA11EB33D370",
        "AC8B054454EF7153EC3F9575FC5C6BC5A81827569C0340D0BDFFB1A2CCE93C61",
        "72493CFD89771BA4C941CA5AF982EE1E6C14A4AA36071B3AD39091AC0A4AA7AB",
        "E24D8629D35172BC29D3B48974E8C869BD8C92FE2E25D9EF35AD380BDE4A14EC"
    ]).unwrap());

    //eprintln!("r_mgf: {:0wid$X}", mgpc.r_mgf(), wid=TEST_HEXDG);
    assert_eq!(*mgpc.r_mgf(), hex_to_Montgomery4096(&[
        "F14289EBCA85CA3DD99E8057F9301CC5A59C92E97A366067294BF176AD7B15C4",
        "67357D5C8D03E48F5FE7184338D54722033785E8B92E7966250711C96064F9FA",
        "A429B1A9DB50E5F2B4D89614AB5B3195B687819C0F4DB64E465562A9036C5972",
        "3F12460273FEC0085982659BEE81DC629D5E684626E421700E34E572634E8C5E",
        "210EB9A77B9C0DCE00CE207A180EA6F244D54F6D620FA96D5C53CDF818DB2F51",
        "7B2FFEC42B03348DF367646BB1310D58F8EFCA728312FE4A6534A7B68799FE8F",
        "A2FA72447B34E7ACCC7FA85041E3345CCA9627DA9AD4577D42A40F8079401024",
        "82C26C413F3840CA020918EBD0EF401F55FEBC3F958F77EDC375B4DC056376E6",
        "EC0085BC30E3921B32D3A3C709C659B42F1101D8BD86609BFB1DA2DC4B065168",
        "1AE14D904FC4A65BFB97FE85562BFD5BEE75B5CF711F60EF6B03639559D3517D",
        "775D2FDABF5E66790CB814FF2DD13C78830AFBA02B46F4F38CD37F5E31D1C90E",
        "F8FA156506E0890360A45E70959193D2ABD481E0D74DD6F99BE046B063668868",
        "76B2E6B3DDE588B821F749BE08504A23B70889BADE80A3B3A2184FF606CE3E8E",
        "D7AF187D9985D50B3AB751E954C0AAC3C0F4B46B044125D3821429F0F620B692",
        "5A22318F1F5D22F317E26C8F869BC48E2F9D4D4E2C0D351E267724FD0AD9B901",
        "C4C167EC12749DA449E5FBCB6BF39E2B31CB2A39B46CF6652E5953604AEF4FF2"
    ]).unwrap());

    /*
    assert_eq!(mgpc.r_mgf(), Nonnegative_4096::ONE);
    // p =                       FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFB17217F7D1CF79ABC9E3B39803F2F6AF40F343267298B62D8A0D175B8BAAFA2BE7B876206DEBAC98559552FB4AFA1B10ED2EAE35C138214427573B291169B8253E96CA16224AE8C51ACBDA11317C387EB9EA9BC3B136603B256FA0EC7657F74B72CE87B19D6548CAF5DFA6BD38303248655FA1872F20E3A2DA2D97C50F3FD5C607F4CA11FB5BFB90610D30F88FE551A2EE569D6DFC1EFA157D2E23DE1400B39617460775DB8990E5C943E732B479CD33CCCC4E659393514C4C1A1E0BD1D6095D25669B333564A3376A9C7F8A5E148E82074DB6015CFE7AA30C480A5417350D2C955D5179B1E17B9DAE313CDB6C606CB1078F735D1B2DB31B5F50B5185064C18B4D162DB3B365853D7598A1951AE273EE5570B6C68F96983496D4E6D330AF889B44A02554731CDC8EA17293D1228A4EF98D6F5177FBCF0755268A5C1F9538B98261AFFD446B1CA3CF5E9222B88C66D3C5422183EDC99421090BBB16FAF3D949F236E02B20CEE886B905C128D53D0BD2F9621363196AF503020060E49908391A0C57339BA2BEBA7D052AC5B61CC4E9207CEF2F0CE2D7373958D762265890445744FB5F2DA4B751005892D356890DEFE9CAD9B9D4B713E06162A2D8FDD0DF2FD608FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
    // crybi.params.modulus:     FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFB17217F7D1CF79ABC9E3B39803F2F6AF40F343267298B62D8A0D175B8BAAFA2BE7B876206DEBAC98559552FB4AFA1B10ED2EAE35C138214427573B291169B8253E96CA16224AE8C51ACBDA11317C387EB9EA9BC3B136603B256FA0EC7657F74B72CE87B19D6548CAF5DFA6BD38303248655FA1872F20E3A2DA2D97C50F3FD5C607F4CA11FB5BFB90610D30F88FE551A2EE569D6DFC1EFA157D2E23DE1400B39617460775DB8990E5C943E732B479CD33CCCC4E659393514C4C1A1E0BD1D6095D25669B333564A3376A9C7F8A5E148E82074DB6015CFE7AA30C480A5417350D2C955D5179B1E17B9DAE313CDB6C606CB1078F735D1B2DB31B5F50B5185064C18B4D162DB3B365853D7598A1951AE273EE5570B6C68F96983496D4E6D330AF889B44A02554731CDC8EA17293D1228A4EF98D6F5177FBCF0755268A5C1F9538B98261AFFD446B1CA3CF5E9222B88C66D3C5422183EDC99421090BBB16FAF3D949F236E02B20CEE886B905C128D53D0BD2F9621363196AF503020060E49908391A0C57339BA2BEBA7D052AC5B61CC4E9207CEF2F0CE2D7373958D762265890445744FB5F2DA4B751005892D356890DEFE9CAD9B9D4B713E06162A2D8FDD0DF2FD608FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
    // R = 2^4096 (mod p, reg) = 00000000000000000000000000000000000000000000000000000000000000004E8DE8082E308654361C4C67FC0D0950BF0CBCD98D6749D275F2E8A4745505D4184789DF92145367AA6AAD04B505E4EF12D151CA3EC7DEBBD8A8C4D6EE9647DAC16935E9DDB5173AE53425EECE83C7814615643C4EC99FC4DA905F1389A808B48D31784E629AB7350A205942C7CFCDB79AA05E78D0DF1C5D25D2683AF0C02A39F80B35EE04A4046F9EF2CF07701AAE5D11A9629203E105EA82D1DC21EBFF4C69E8B9F88A24766F1A36BC18CD4B8632CC3333B19A6C6CAEB3B3E5E1F42E29F6A2DA9964CCCA9B5CC895638075A1EB717DF8B249FEA301855CF3B7F5ABE8CAF2D36AA2AE864E1E846251CEC324939F934EF8708CA2E4D24CE4A0AF4AE7AF9B3E74B2E9D24C4C9A7AC28A675E6AE51D8C11AA8F4939706967CB692B192CCF507764BB5FDAAB8CE323715E8D6C2EDD75B1067290AE880430F8AAD975A3E06AC7467D9E5002BB94E35C30A16DDD4773992C3ABDDE7C12366BDEF6F444E9050C26B60DC91FD4DF31177946FA3ED72AC2F42D069DEC9CE6950AFCFDFF9F1B66F7C6E5F3A8CC645D414582FAD53A49E33B16DF8310D0F31D28C8C6A7289DD9A76FBBA8BB04A0D25B48AEFFA76D2CA976F210163526462B48EC1F9E9D5D27022F20D029F70000000000000000000000000000000000000000000000000000000000000001
    // crybi.params.r:           00000000000000000000000000000000000000000000000000000000000000004E8DE8082E308654361C4C67FC0D0950BF0CBCD98D6749D275F2E8A4745505D4184789DF92145367AA6AAD04B505E4EF12D151CA3EC7DEBBD8A8C4D6EE9647DAC16935E9DDB5173AE53425EECE83C7814615643C4EC99FC4DA905F1389A808B48D31784E629AB7350A205942C7CFCDB79AA05E78D0DF1C5D25D2683AF0C02A39F80B35EE04A4046F9EF2CF07701AAE5D11A9629203E105EA82D1DC21EBFF4C69E8B9F88A24766F1A36BC18CD4B8632CC3333B19A6C6CAEB3B3E5E1F42E29F6A2DA9964CCCA9B5CC895638075A1EB717DF8B249FEA301855CF3B7F5ABE8CAF2D36AA2AE864E1E846251CEC324939F934EF8708CA2E4D24CE4A0AF4AE7AF9B3E74B2E9D24C4C9A7AC28A675E6AE51D8C11AA8F4939706967CB692B192CCF507764BB5FDAAB8CE323715E8D6C2EDD75B1067290AE880430F8AAD975A3E06AC7467D9E5002BB94E35C30A16DDD4773992C3ABDDE7C12366BDEF6F444E9050C26B60DC91FD4DF31177946FA3ED72AC2F42D069DEC9CE6950AFCFDFF9F1B66F7C6E5F3A8CC645D414582FAD53A49E33B16DF8310D0F31D28C8C6A7289DD9A76FBBA8BB04A0D25B48AEFFA76D2CA976F210163526462B48EC1F9E9D5D27022F20D029F70000000000000000000000000000000000000000000000000000000000000001
    // R = 2^4096 (mod p, mgf) = F14289EBCA85CA3DD99E8057F9301CC5A59C92E97A366067294BF176AD7B15C467357D5C8D03E48F5FE7184338D54722033785E8B92E7966250711C96064F9FAA429B1A9DB50E5F2B4D89614AB5B3195B687819C0F4DB64E465562A9036C59723F12460273FEC0085982659BEE81DC629D5E684626E421700E34E572634E8C5E210EB9A77B9C0DCE00CE207A180EA6F244D54F6D620FA96D5C53CDF818DB2F517B2FFEC42B03348DF367646BB1310D58F8EFCA728312FE4A6534A7B68799FE8FA2FA72447B34E7ACCC7FA85041E3345CCA9627DA9AD4577D42A40F807940102482C26C413F3840CA020918EBD0EF401F55FEBC3F958F77EDC375B4DC056376E6EC0085BC30E3921B32D3A3C709C659B42F1101D8BD86609BFB1DA2DC4B0651681AE14D904FC4A65BFB97FE85562BFD5BEE75B5CF711F60EF6B03639559D3517D775D2FDABF5E66790CB814FF2DD13C78830AFBA02B46F4F38CD37F5E31D1C90EF8FA156506E0890360A45E70959193D2ABD481E0D74DD6F99BE046B06366886876B2E6B3DDE588B821F749BE08504A23B70889BADE80A3B3A2184FF606CE3E8ED7AF187D9985D50B3AB751E954C0AAC3C0F4B46B044125D3821429F0F620B6925A22318F1F5D22F317E26C8F869BC48E2F9D4D4E2C0D351E267724FD0AD9B901C4C167EC12749DA449E5FBCB6BF39E2B31CB2A39B46CF6652E5953604AEF4FF2
    // crybi.params.r2:          F14289EBCA85CA3DD99E8057F9301CC5A59C92E97A366067294BF176AD7B15C467357D5C8D03E48F5FE7184338D54722033785E8B92E7966250711C96064F9FAA429B1A9DB50E5F2B4D89614AB5B3195B687819C0F4DB64E465562A9036C59723F12460273FEC0085982659BEE81DC629D5E684626E421700E34E572634E8C5E210EB9A77B9C0DCE00CE207A180EA6F244D54F6D620FA96D5C53CDF818DB2F517B2FFEC42B03348DF367646BB1310D58F8EFCA728312FE4A6534A7B68799FE8FA2FA72447B34E7ACCC7FA85041E3345CCA9627DA9AD4577D42A40F807940102482C26C413F3840CA020918EBD0EF401F55FEBC3F958F77EDC375B4DC056376E6EC0085BC30E3921B32D3A3C709C659B42F1101D8BD86609BFB1DA2DC4B0651681AE14D904FC4A65BFB97FE85562BFD5BEE75B5CF711F60EF6B03639559D3517D775D2FDABF5E66790CB814FF2DD13C78830AFBA02B46F4F38CD37F5E31D1C90EF8FA156506E0890360A45E70959193D2ABD481E0D74DD6F99BE046B06366886876B2E6B3DDE588B821F749BE08504A23B70889BADE80A3B3A2184FF606CE3E8ED7AF187D9985D50B3AB751E954C0AAC3C0F4B46B044125D3821429F0F620B6925A22318F1F5D22F317E26C8F869BC48E2F9D4D4E2C0D351E267724FD0AD9B901C4C167EC12749DA449E5FBCB6BF39E2B31CB2A39B46CF6652E5953604AEF4FF2
    // R^-1 (mod p, reg) =       BF9B405D1C28111D456ACF32DC12355CFED23236158F7D0E08954A8DF3978161E60C086BC1B7D5CEB94BA33E8675144B23A08FEE288C52859F283EA3E0CDEF27CE2135E2D48247EE4C4897B8ADACE025A019A63020896CD0FFFC92402604FD0FE1146BB349EF9E766B3DEFFACB048C233D243D38389A100F02919B124321D9C587DA5666111886886CACB21CFAA4526E9F0906E206150704040E433FC37B76587591D7534B5DCDAF892C63D8B295B043EA4C8B3D45CB41B0881A5DB3E37D76C342942411C34CE98D8357D24304D0978E4EFD12121189E8334DE1AF2FA77E9D961E0FC19A9BDA50823B21301C842CE8D5FBA9E9149DCF6A821B66F2D67443DAB030FE5A4665FA142F3AE8F9D0631147A864223CACDE9DD2C8F279C87953F8158AC35CA846B85C0F9E6BC43CD3844FA27F1D6C91FEC8446C9F3CB57FC3B2877E8C4BA7468278C2E6C30D80131D0547EB2B48C5D64341131B3A19CA9326EEB3B291866E7F060C8DF689CEBAD599DD80E0D094C772ABBD792E61D2352985C38C12B6A6E10DD80DDF25DBF7126F1436115424B5875AB84E78658F510EAA11EB33D370AC8B054454EF7153EC3F9575FC5C6BC5A81827569C0340D0BDFFB1A2CCE93C6172493CFD89771BA4C941CA5AF982EE1E6C14A4AA36071B3AD39091AC0A4AA7ABE24D8629D35172BC29D3B48974E8C869BD8C92FE2E25D9EF35AD380BDE4A14EC
    // R^-1 (mod p, mgf) =       0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001
    // crybi.params.r3:          078A8C60FFE1E25D8553E341229ABC896E48D3ED001BC6AE8CCD6929322664C49270F2509032008FC41F7881F9B1E6AF828A5A7C640B6A4496CA20A1F0DB3A3F73B9C643AE72D76C4E9DAAE0E46DB5CFE23669306DC54AFC2EE6A70944D5460D82025A365CE5C4498AF26ACF0508028D4B471F92C158725F6F67C1A347A60374EF24085AF20AE98A83F3C0341809F0E95A28F4CA5C2E2C4A00E97B0F485CB3FE2388B5BFC8B41984EBC4C6BD709C0D1E8C07D971D19DDFC9B597C7D9881CF5039D12399A198E8C2E148E79F3054F727416E6DBC4190649A955C5B2C8552185C378E70724E3FC261AF7949F4FC0B367770E588937BC1B572139603A3E19FDB9CF98642A31156B8F4E6E259F8B2CD14F4B313921BE0DBB7E25AD07D8822A64BF7E2F4A254843C548B1FC2E52C35C4D96C5CD3DFD6A46077AE1E169BAF51A395F317A7EB03E35E09C98933E721624EC6E0D49F705C37FD15ECE0C9CE3B00005CB1B0AD30A09156471B97E043FDE5E94EC334171CE979DFF755E0006C8A3E96769A28143F2214C1FB80D66AD3FE98913D024DA08C2A0A614131BC8815C5B8EE9F55D2D52BF42604CC7D149552376789F8E4DCF6E2EA4FBE899137022BD2DB92EC06734D4D02B8168A06220C2271342BDDC44FADAB14DB89D82172AC52B37D7F3734F9324C2F0992DE9A50334BFCA0CC4AFAAE97D309D7F2C92A876AB4378276B91D0
    // crybi.params.mod_neg_inv: Limb(0x0000000000000001)
    */
}
